<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/gif" href="data:image/gif;base64,R0lGODlhEAAQAIAAAAAAAAAAACH5BAkAAAEALAAAAAAQABAAAAIgjI+py+0PEQiT1lkNpppnz4HfdoEH2W1nCJRfBMfyfBQAOw==" />
    <title>Document</title>
</head>
<body>
    <svg id="stage" version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg"></svg>

    <script src="/js/helpers.js"></script>
    <script src="/js/stage.js"></script>
    <script src="/js/world.js"></script>
    <script src="/js/key-listener.js"></script>
    <script src="/js/vector.js"></script>
    <script src="/js/character.js"></script>
    <script src="/js/force.js"></script>
    <script src="/js/wing-force.js"></script>

    <script>

        var key_listener = new KeyListener({'thrust': 'k'});

        var weight = new Force(function(){this.relative_position.equate(this.character.cog)},
                               function(){this.value.setPolar(90, this.character.mass * this.character.world.gravity)},
                               'weight',
                               'green');

        var thrust = new Force(function(){this.relative_position.setXY(10, 2.3)},
                               function(){
                                    var angle = this.character.orientation;
                                    var magnitude = this.character.key_listener.isPushed('thrust') ? 7000 : 0;
                                    this.value.setPolar(angle, magnitude)},
                               'thrust',
                               'blue');

        var wing   = new WingForce(function(){
                                      this.relative_position.setXY(
                                        this.character.cog.getX() - 0.5,
                                        this.character.cog.getY() - 0.1
                                      );
                                   },
                                   function(){return -3;},
                                   16.2,
                                   'wing',
                                   'orange');

        var tail   = new WingForce(function(){
                                      this.relative_position.setXY(0.2, 2.3);
                                   },
                                   function(){return 4;},
                                   3.5,
                                   'left',
                                   'orange');

        var plane = new Character('plane',
                                  '/img/plane.png',
                                  10, // width
                                  5, // height
                                  Vector.create().setXY(7.3, 2.3), // CoG
                                  Vector.create().setXY(25, 15), // Position
                                  -1, // orientation
                                  [weight, thrust, wing, tail], // forces
                                  Vector.create(-3, 5), // velocity
                                  350, // mass in kg
                                  0, // angular velocity
                                  key_listener); // moment of inertia

        var world = new World([plane]);

        var stage = new Stage('stage', world);

        var go = 1;
        var interval = 0.025;// in seconds


        setInterval(
            function(){
                world.update(interval);
                stage.render();
            },
            interval * 1000
        );

    </script>
    
</body>
</html>