<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<svg version="1.1"
     baseProfile="full"
     width="700"
     height="400"
     xmlns="http://www.w3.org/2000/svg"
     id="stage"
     style='background-color: #CCC;'>


  <image xlink:href="img/plane.png" id="plane"/>

</svg>

<script>



function placeElement(element, x, y, angle){
  var angle_degrees = angle  * 180/Math.PI;
  element.setAttribute('x', x-width/2);
  element.setAttribute('y', y-height/2);
  element.setAttribute('transform', 'rotate('+angle_degrees+' '+x+' '+y+')')
}

var keys = [
  {code: 37, name: 'pitch_up'},
  {code: 39, name: 'pitch_down'},
  {code: 38, name: 'throttle'},
  {code: 40, name: 'brake'}
];

var frame = 0;
var x = 500;
var y = 150;
var angle = 0 * Math.PI/180;
var speed = 0;
var throttle_force = 0.1;
var mass = 1;
var dangle = 2 * Math.PI/180;;
var interval = 20;
var go = true;
var plane = document.getElementById('plane');
var width = plane.getBoundingClientRect().width;
var height = plane.getBoundingClientRect().height;
var stage = document.getElementById('stage');
var stage_width = stage.getAttribute('width')/1;
var stage_height = stage.getAttribute('height')/1;

var input = {
  'elevator_up': null,
  'elevator_down': null
};


setInterval(function(){
  if(go){
    update();
    render();
  }
}, interval);

function clearInput(){
  input.elevator_up = null;
  input.elevator_down = null;
}

function update(){
  frame++;
  updateAngle();
  updateSpeed();
  updatePosition();
}

function updateAngle(){
  if(input.pitch_up){
    angle-=dangle;
  }
  if(input.pitch_down){
    angle+=dangle;
  }
}

function updateSpeed(){
  if(input.throttle){
    speed += throttle_force / mass;
  }
  if(input.brake){
    speed -= throttle_force / mass;
  }
}

function updatePosition(){
  var dx = -speed * Math.cos(angle);
  var dy = -speed * Math.sin(angle);
  x += dx;
  y += dy;

  // bound to box
  if(y > stage_height){y = stage_height;}

  if(x<0){x = stage_width+x;}
}

function render(){
  placeElement(plane, x, y, angle);
}

var planea = {
    x: 50,
    y: 50,
    dx: 10,
    dy: 0,
    ddx: 0,
    ddy: 0,
    theta: 0
}

document.addEventListener('keydown', function(event) {
  keys.forEach(function(key){
    if(event.keyCode == key.code) {
        input[key.name] = true;
    }
  });
});

document.addEventListener('keyup', function(event) {
  keys.forEach(function(key){
    if(event.keyCode == key.code) {
        input[key.name] = false;
    }
  });
});


</script>
</body>
</html>